The purpose of this tutorial is to show you how to package your Python scripts as a single distributable artifact using [pex](https://pypi.org/project/pex/).

[This text and all of the code can be found at github.com/chr15m/single-binary-python](https://github.com/chr15m/single-binary-python).

Platforms like Rust and Go output a single binary by default. This has a number of nice properties:

 * Easier to work with. You only have one thing to upload, copy around, etc.
 * No dependencies. They're baked into the binary.

This makes deployment and distribution simpler. You can copy the binary onto your device and run it.

This works well for smallish programs without a ton of dependencies like:

 * A web based microservice.
 * A TCP/IP server on an embedded Raspberry Pi.
 * A command line utility for doing devops tasks.

## Assumptions & tradeoffs

Unlike Rust and Go we are going to rely on the presence of Python on the target system. The artifact will run on any computer which has a `python` binary on the path. So what we are doing is bundling all of the code and dependencies into the binary but not the Python runtime. In some ways this is more flexible than architecture specific binaries like those generated by Go and Rust, because we can write programs which target **any version of Python** and ship the same binary to all of them. The same binary artifact can run on Python 2.7, 3.5, etc. and on any platform (Linux, OSX, Windows, etc.) with no other dependencies.

As long as we a) write portable code b) have a Python executable somewhere on the target machine's path, it will run. Fortunately most machines these days have some version of Python installed and it's possible to make your package
completely version independent by coding with this in mind.

## Our `demo.py` example

We're going to ship a small CLI program `demo.py` which uses two libraries (`sh` and `click`). All it is going to do is read some JSON and run some commands. We're going to use [pex]() to bundle the script and its dependencies up into a binary.

## Basic setup

To accomplish this we need 3 files.

### `setup.py`

A minimal two line file to tell `pex` how to package our script.

```
from distutils.core import setup
setup(name='demo', version='0.0.1', scripts=['demo.py'])
```

### `requirements.txt`

Our list of dependencies.

### `setup.cfg`

 * `setup.py`. Can be just one line long. 
 * `requirements.txt` 
 * `setup.cfg`. Two lines long. we need this to tell `pex` that we want a "universal" distributable that will work on multiple platforms.

# The script

Let's start with a very simple script. We'll output some system info and to make things interesting we'll also use a 3rd party Python module.

```
import sh
from sys import version

print("Hello from a Python agnostic binary!")
print("Python version:", version)
print("Uname:", sh.uname("-a"))
```


# Build it
